<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polaroid Slider</title>
</head>
<style>
    @font-face {
        font-family: polaroid;
        src: url(./Photograph_Signature.ttf);
    }

    :root{
        --polaroidDesktopWidth:20vw;
        --polaroidMobileWidth:90vw;
    }
    body, html, .slider
    {
        min-height: 100vh;
        min-width: 100vw;
    }
    *{
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    body
    {
        background-color: #f8e9dd;
    }
    .slider
    {
        display: flex;
        justify-content: space-around;
        align-items: center;
        /* padding-right: 5em; */
        height: 100%;
        width: 100%;
    }

    .slider-center .polaroid
    {
        scale: 1;
        top: 30%;
        left: 50%;
        transform: translateX(-50%);
    }
    .slider > div
    {
        width: 33%;
        height: 100vh;
        position: relative;
    }
    .polaroid
    {
        display: inline;
        width: var(--polaroidDesktopWidth);
        height: calc(var(--polaroidDesktopWidth) * 1.16);
        background-color: #fff;
        padding: 20px 20px 30px 20px;
        margin-right: 2em;
        box-shadow: 2px 0 10px grey;
        position: absolute;
        top: 30%;
        left: 30%;
        scale: .5;
        transform-style: preserve-3d;
        pointer-events: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    .photo
    {
        background-color: black;
        height: calc(var(--polaroidDesktopWidth) * 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        pointer-events: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    .slider img 
    {
        display: block;
        margin: auto;
        max-width: 100%;
        max-height: 100%;
        pointer-events: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .photo span {
        position: absolute;
        bottom: -25%;
        left: 50%;
        transform: translateX(-50%);
        font-family: polaroid;
        font-size: 1.15em;
        display: inline-block;
        width: max-content;
    }
    


    /* KEYFRAMES */

    /* desktop */
    @keyframes rightToCenterDesktop {
        to{
            transform: translateX(-100%);
            scale: 1;
            left: -20%;
        }
    }
    @keyframes centerToLeftDesktop {
        to{
            scale: .5;
            left: -70%;
            transform: rotate(var(--rotation));
        }
    }
    @keyframes leftToCenterDesktop {
        to{
            transform: translateX(100%);
            scale: 1;
            left: 90%;
        }
    }
    @keyframes centerToRightDesktop {
        /* 0%{
            transform: initial;
        } */
       
        to{
            scale: .5;
            left: 130%;
            transform: rotate(var(--rotation));
        }
    }
    /* Mobile */
    @keyframes rightToCenterMobile {
        from {
            scale:.25;
        }
        to{
            transform: translateY(-25vh);
            scale: 1.5;
            right: 15vw;
        }
    }
    @keyframes centerToLeftMobile {
        to{
            scale: .5;
            left: -4em;
            transform: translateY(50vh) rotate(var(--rotation));
        }
    }
    @keyframes leftToCenterMobile {
        from {
            scale:.5;
        }
        to{
            transform: translateY(-50vh);
            scale: 1.5;
            left: 15vw;
        }
    }
    @keyframes centerToRightMobile {
        to{
            scale: .5;
            right: -5em;
            transform: translateY(50vh) rotate(var(--rotation));
        }
    }
    @media screen and (max-width:960px) {
        .slider{
            flex-wrap: wrap;
            padding-top: 4em;
        }
        .slider > div{
            height: 100%;
        }
        .polaroid{
            margin-right: unset;
        }
        .slider .slider-center{
            width: 100%;
            flex:1 0 100%;
            order: 1;
        }
        .slider .slider-left{
            order: 2;
        }
        .slider .slider-right{
            order: 3;
        }
        .photo{
            height: calc(var(--polaroidMobileWidth) * 0.8);
        }
        .polaroid{
            width: var(--polaroidMobileWidth);
            height: calc(var(--polaroidMobileWidth) * 1.16);
            top: 0;
            left: 50%;
            transform: translate(-50%, -35%);
            z-index: 2;
        }
        .slider-left .polaroid, .slider-right .polaroid{
            top: -5em;
            scale: 0.25;
        }
        .slider-left .polaroid{
            left:-4em;
            z-index: 1;
        }
        .slider-right .polaroid{
            left: -25vw;
            z-index: 3;
        }
    }
    @media screen and (min-width:1400px)
    {
        .photo span{
            font-size: 2em;
        }
    }
</style>
<body>
    <section class="slider" id = "slider" draggable="false">
        <div class="slider-left" draggable="false"></div>
        <div class="slider-center" draggable="false"></div>
        <div class="slider-right" draggable="false">
            <div class="polaroid" draggable="false">
                <div class="photo" draggable="false">
                    <img src="./paysage.jpg" alt="" draggable="false">
                    <span>Shaking Hands</span>
                </div>
            </div>
            <div class="polaroid" draggable="false">
                <div class="photo" draggable="false">
                    <img src="./portrait.jpg" alt="" draggable="false">
                    <span>My self portrait</span>
                </div>
            </div>
            <div class="polaroid" draggable="false">
                <div class="photo" draggable="false">
                    <img src="./paysage.jpg" alt="" draggable="false">
                    <span>Shaking Hands</span>
                </div>
            </div>
            <div class="polaroid" draggable="false">
                <div class="photo" draggable="false">
                    <img src="./portrait.jpg" alt="" draggable="false">
                    <span>My self portrait</span>
                </div>
            </div>
            <div class="polaroid" draggable="false">
                <div class="photo" draggable="false">
                    <img src="./paysage.jpg" alt="" draggable="false">
                    <span>Shaking Hands</span>
                </div>
            </div>
            <div class="polaroid" draggable="false">
                <div class="photo" draggable="false">
                    <img src="./portrait.jpg" alt="" draggable="false">
                    <span>My self portrait</span>
                </div>
            </div>
        </div>
    </section>
</body>
<script>
    var slider = document.getElementById('slider')
    var sliderLeft = slider.querySelector('.slider-left')
    var sliderCenter = slider.querySelector('.slider-center')
    var sliderRight = slider.querySelector('.slider-right')
    var animationDevice = window.innerWidth > 960 ? "Desktop" : "Mobile"
    function randomIntFromInterval(min, max) { // min and max included 
    return Math.floor(Math.random() * (max - min + 1) + min)
    }
    const polaroids = document.querySelectorAll('.slider .polaroid');
    for(let i = 0; i < polaroids.length;i++)
    {
        let polaroid = polaroids[i];
        // polaroid.style.zIndex = i;
        const rotate = randomIntFromInterval(0, 360);
        const translate = randomIntFromInterval(10, 15);
        polaroid.style.transform = `translateX(-${translate}%) rotate(${rotate}deg)`
    }
    var mouseX;
    var isBlocked = false;
    slider.addEventListener('mousedown', e => {
        mouseX = e.clientX
    })
    slider.closest('body').addEventListener('mouseup', e => {
        handleKeyUp(e.clientX)   
    })
    slider.addEventListener('touchstart', e => {
        window.mouseX = e.targetTouches[0].clientX
        window.isBlocked = false;
    })
    var isTouching = false
    slider.addEventListener('touchmove', e => {
        if(!isTouching)
        {
            window.mouseX = e.targetTouches[0].clientX
            isTouching = true
            setTimeout(() => {
                handleKeyUp(window.mouseX, slider) 
                isTouching = false
            }, 500)
        }
        e.preventDefault()
    })
    slider.addEventListener('touchend', e => {
        handleKeyUp(e.changedTouches[0].clientX)       
    })

    function handleKeyUp(clientX)
    {
        if(clientX - mouseX < 0 && isBlocked == false)
        {
            isBlocked = true;
            toLeft()
        }
        else if(clientX - mouseX > 0 && isBlocked == false)
        {
            isBlocked = true;
            toRight()
        }
    }
    function toLeft()
    {
        console.log("toLeft");
        // Center To Left
        const polaroidsCenter = sliderCenter.querySelectorAll(`.polaroid`)
        if(polaroidsCenter.length > 0)
        {
            const picked = polaroidsCenter[polaroidsCenter.length-1]
            const rotate = randomIntFromInterval(0, 360);
            picked.style.setProperty('--rotation', `${rotate}deg`)
            picked.style.animation = `2s ease-in forwards centerToLeft${animationDevice}`
            setTimeout(() => {
                picked.style.transform = `rotate(${rotate}deg)`  
                picked.style.animation = ""
                sliderLeft.appendChild(picked)
                isBlocked = false;
                slider.focus()
            }, 2000);
        }
        // Right To Center
        const polaroidsRight = sliderRight.querySelectorAll(`.polaroid`)
        if(polaroidsRight.length > 0)
        {
            const picked = polaroidsRight[polaroidsRight.length-1]
            picked.style.animation = `2s ease-in forwards rightToCenter${animationDevice}`
            setTimeout(() => {
                picked.style.animation = ""
                picked.style.transform = ""
                sliderCenter.appendChild(picked)
                isBlocked = false;
                slider.focus()
            }, 2000);
        }
    }
    function toRight()
    {
        console.log("toRight");
         // Center To Right
         const polaroidsCenter = sliderCenter.querySelectorAll(`.polaroid`)
        if(polaroidsCenter.length > 0)
        {
            const picked = polaroidsCenter[polaroidsCenter.length-1]
            const rotate = randomIntFromInterval(0, 360);
            picked.style.setProperty('--rotation', `${rotate}deg`)
            picked.style.animation = `2s ease-in forwards centerToRight${animationDevice}`
            picked.style.zIndex = "1"
            setTimeout(() => {
                picked.style.transform = `rotate(${rotate}deg)`  
                picked.style.zIndex = ""
                picked.style.animation = ""
                sliderRight.appendChild(picked)
                isBlocked = false;
                slider.focus()
            }, 2000);
        }
        // Left To Center
        const polaroidsLeft = sliderLeft.querySelectorAll(`.polaroid`)
        if(polaroidsLeft.length > 0)
        {
            const picked = polaroidsLeft[polaroidsLeft.length-1]
            picked.style.animation = `2s ease-in forwards leftToCenter${animationDevice}`
            setTimeout(() => {
                picked.style.animation = ""
                picked.style.transform = ""
                sliderCenter.appendChild(picked)
                isBlocked = false;
                slider.focus()
            }, 2000);
        }
    }
</script>
</html>